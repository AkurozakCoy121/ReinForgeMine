<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReinForgeSize</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Dark background, industrial feel */
            color: #c9d1d9;
        }
        .card {
            background-color: #161b22;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.4);
        }
        .input-style {
            background-color: #0d1117;
            border: 1px solid #30363d;
            color: #c9d1d9;
            transition: border-color 0.2s;
        }
        .input-style:focus {
            border-color: #58a6ff;
            box-shadow: 0 0 0 1px #58a6ff;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="main-container" class="w-full max-w-lg mx-auto card p-8 rounded-xl space-y-6">

        <h1 class="text-3xl font-bold text-center text-green-400">ReinForgeSize</h1>
        <p class="text-center text-sm text-gray-400">Alat Konversi Ukuran Gambar Khusus Tim ReinForge</p>

        <!-- Header Key Display & Copy Button -->
        <div id="header-key-area" class="flex items-center justify-center space-x-3 p-3 bg-gray-700/50 rounded-lg">
            <span class="text-sm font-medium">Kode Kunci Sesi (Wajib di-Copy):</span>
            <div class="flex items-center bg-gray-800 p-2 rounded-md border border-gray-700">
                <span id="generated-key" class="text-lg font-mono tracking-widest text-yellow-400 select-all cursor-pointer mr-3"></span>
                <button id="copy-key-button" class="text-blue-400 hover:text-blue-300 transition duration-150 focus:outline-none" title="Salin Kode Kunci">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
                        <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Notification Area -->
        <div id="notification" class="hidden p-3 rounded-lg text-center font-medium" role="alert"></div>

        <!-- Authentication View -->
        <div id="auth-view" class="space-y-4">
            <div>
                <label for="input-key" class="block text-sm font-medium mb-1">1. Masukkan Kode Kunci Sesi:</label>
                <input type="text" id="input-key" placeholder="Paste kode kunci di atas..." class="input-style w-full p-2.5 rounded-md">
            </div>
            <div>
                <label for="input-token" class="block text-sm font-medium mb-1">2. Masukkan Token Akses Tim (Rahasia):</label>
                <!-- Menggunakan type="password" agar input token tidak mudah dideteksi isinya saat diketik/di-paste -->
                <input type="password" id="input-token" placeholder="Token rahasia yang super panjang..." class="input-style w-full p-2.5 rounded-md">
            </div>
            <button id="auth-button" class="w-full py-2.5 rounded-md bg-green-600 hover:bg-green-700 transition duration-200 font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                Masuk ke ReinForge
            </button>
        </div>

        <!-- Application View (Hidden initially) -->
        <div id="app-view" class="hidden space-y-6">
            <h2 class="text-2xl font-semibold text-center text-blue-400">Konverter Gambar</h2>

            <!-- Input File -->
            <div>
                <label for="image-file" class="block text-sm font-medium mb-1">Pilih File Gambar:</label>
                <input type="file" id="image-file" accept="image/*" class="w-full text-sm input-style p-2 rounded-md file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600">
            </div>

            <!-- Resizing Options -->
            <div class="flex space-x-4">
                <div class="flex-1">
                    <label for="new-width" class="block text-sm font-medium mb-1">Lebar Baru (px):</label>
                    <input type="number" id="new-width" placeholder="Contoh: 800" class="input-style w-full p-2.5 rounded-md" min="1">
                </div>
                <div class="flex-1">
                    <label for="new-height" class="block text-sm font-medium mb-1">Tinggi Baru (px):</label>
                    <input type="number" id="new-height" placeholder="Contoh: 600" class="input-style w-full p-2.5 rounded-md" min="1">
                </div>
            </div>

            <button id="convert-button" class="w-full py-2.5 rounded-md bg-blue-600 hover:bg-blue-700 transition duration-200 font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 disabled:opacity-50" disabled>
                Konversi dan Download
            </button>

            <!-- Result Display (Hidden initially) -->
            <div id="result-area" class="hidden pt-4 border-t border-gray-700 mt-4 space-y-3">
                <p class="text-sm font-semibold text-center">Hasil Konversi:</p>
                <img id="resized-image" class="w-full max-h-64 object-contain rounded-md border border-gray-700" alt="Gambar Hasil Konversi">
                <a id="download-link" href="#" download="reinforgesize_converted.png" class="block text-center py-2.5 bg-yellow-600 hover:bg-yellow-700 rounded-md font-semibold transition duration-200">
                    Klik untuk Download Gambar
                </a>
            </div>
            
            <!-- Canvas for resizing (Hidden) -->
            <canvas id="image-canvas" class="hidden"></canvas>
        </div>
    </div>

    <script>
        // Inisialisasi variabel global
        const GENERATED_KEY_LENGTH = 6;
        // Token rahasia tim yang sangat panjang dan sulit ditebak
        const SECRET_TOKEN = "ReinForgeAccess-93XpQzL7sKjR5aBcFgH1vN8wT2yU4iD6oE0mJ9pY3qZc1xL8eY0oU2rTv4pI3aM7nK9bC2dQ5sF8tG1wA0zXvB3nC6mQ9sP4lK7jH0gF2dD5eR8tY1uI4oP7";
        
        let currentGeneratedKey = '';

        // Elemen DOM
        const generatedKeyEl = document.getElementById('generated-key');
        const copyKeyButton = document.getElementById('copy-key-button');
        const notificationEl = document.getElementById('notification');
        const authView = document.getElementById('auth-view');
        const appView = document.getElementById('app-view');
        const authButton = document.getElementById('auth-button');
        const inputKey = document.getElementById('input-key');
        const inputToken = document.getElementById('input-token');
        
        const imageFileEl = document.getElementById('image-file');
        const newWidthEl = document.getElementById('new-width');
        const newHeightEl = document.getElementById('new-height');
        const convertButton = document.getElementById('convert-button');
        const resultArea = document.getElementById('result-area');
        const resizedImageEl = document.getElementById('resized-image');
        const downloadLink = document.getElementById('download-link');
        const canvas = document.getElementById('image-canvas');
        const ctx = canvas.getContext('2d');

        /**
         * Menampilkan notifikasi sementara di UI.
         * @param {string} message Pesan notifikasi.
         * @param {string} type 'success' atau 'error'.
         */
        function showNotification(message, type) {
            notificationEl.textContent = message;
            notificationEl.className = 'p-3 rounded-lg text-center font-medium'; // Reset classes
            
            if (type === 'success') {
                notificationEl.classList.add('bg-green-800', 'text-green-300');
            } else if (type === 'error') {
                notificationEl.classList.add('bg-red-800', 'text-red-300');
            }
            notificationEl.classList.remove('hidden');

            // Sembunyikan setelah 5 detik
            setTimeout(() => {
                notificationEl.classList.add('hidden');
            }, 5000);
        }

        /**
         * Membuat kunci acak alfanumerik.
         * @param {number} length Panjang kunci yang diinginkan.
         * @returns {string} Kunci yang dihasilkan.
         */
        function generateRandomKey(length) {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        /**
         * Logika untuk proses Autentikasi.
         */
        authButton.addEventListener('click', () => {
            const enteredKey = inputKey.value.trim();
            const enteredToken = inputToken.value;

            if (enteredKey === '' || enteredToken === '') {
                showNotification('Kode Kunci dan Token Akses tidak boleh kosong.', 'error');
                return;
            }

            if (enteredKey === currentGeneratedKey && enteredToken === SECRET_TOKEN) {
                authView.classList.add('hidden');
                appView.classList.remove('hidden');
                document.getElementById('header-key-area').classList.add('hidden'); // Sembunyikan kode kunci setelah masuk
                showNotification('Akses diterima. Selamat datang di ReinForgeSize!', 'success');
            } else {
                showNotification('Autentikasi Gagal. Periksa Kode Kunci Sesi dan Token Akses Anda.', 'error');
            }
        });

        /**
         * Logika untuk Resizing Gambar.
         */
        convertButton.addEventListener('click', () => {
            const file = imageFileEl.files[0];
            const newWidth = parseInt(newWidthEl.value);
            const newHeight = parseInt(newHeightEl.value);

            if (!file) {
                showNotification('Mohon pilih file gambar terlebih dahulu.', 'error');
                return;
            }
            if (isNaN(newWidth) || isNaN(newHeight) || newWidth <= 0 || newHeight <= 0) {
                showNotification('Lebar dan Tinggi harus berupa angka positif.', 'error');
                return;
            }

            convertButton.disabled = true;
            convertButton.textContent = 'Memproses...';

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    try {
                        // Atur ukuran canvas ke dimensi baru
                        canvas.width = newWidth;
                        canvas.height = newHeight;

                        // Gambar ulang gambar ke canvas dengan dimensi baru
                        ctx.drawImage(img, 0, 0, newWidth, newHeight);

                        // Dapatkan data gambar dari canvas (misalnya sebagai PNG)
                        const resizedDataUrl = canvas.toDataURL('image/png');

                        // Update tampilan hasil
                        resizedImageEl.src = resizedDataUrl;
                        downloadLink.href = resizedDataUrl;
                        resultArea.classList.remove('hidden');
                        
                        showNotification('Konversi berhasil!', 'success');
                    } catch (error) {
                        showNotification('Gagal memproses gambar. Pastikan file valid.', 'error');
                        console.error("Image processing error:", error);
                    } finally {
                        convertButton.disabled = false;
                        convertButton.textContent = 'Konversi dan Download';
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });

        // Toggle tombol convert berdasarkan input
        function checkConversionInputs() {
            const fileSelected = imageFileEl.files.length > 0;
            const widthValid = parseInt(newWidthEl.value) > 0;
            const heightValid = parseInt(newHeightEl.value) > 0;

            convertButton.disabled = !(fileSelected && widthValid && heightValid);
        }

        imageFileEl.addEventListener('change', checkConversionInputs);
        newWidthEl.addEventListener('input', checkConversionInputs);
        newHeightEl.addEventListener('input', checkConversionInputs);
        
        // Inisialisasi saat halaman dimuat
        window.onload = () => {
            // 1. Generate dan tampilkan Kode Kunci Sesi
            currentGeneratedKey = generateRandomKey(GENERATED_KEY_LENGTH);
            generatedKeyEl.textContent = currentGeneratedKey;

            // 2. Event listener untuk tombol Copy
            copyKeyButton.addEventListener('click', () => {
                // Gunakan document.execCommand('copy') karena navigator.clipboard tidak didukung di beberapa iframe
                const textArea = document.createElement("textarea");
                textArea.value = currentGeneratedKey;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showNotification('Kode Kunci disalin ke clipboard!', 'success');
                } catch (err) {
                    showNotification('Gagal menyalin. Salin manual kode: ' + currentGeneratedKey, 'error');
                }
                document.body.removeChild(textArea);
            });
            
            // 3. Event listener untuk input key/token agar bisa di-trigger pakai Enter
            [inputKey, inputToken].forEach(el => {
                el.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        authButton.click();
                    }
                });
            });
        };
    </script>
</body>
</html>
